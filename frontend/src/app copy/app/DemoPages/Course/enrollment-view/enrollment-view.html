<div class="main-card mb-3 card">
  <div class="card-header d-flex align-items-center justify-content-between">
    <span>Enrollments</span>
    <div class="d-flex align-items-center gap-2">
      <span *ngIf="loading" class="badge bg-info">Loading…</span>
    </div>
  </div>

  <div class="card-body">
    <div *ngIf="error" class="alert alert-danger mb-3">{{ error }}</div>

    <div class="table-responsive">
      <table class="align-middle mb-0 table table-borderless table-striped table-hover">
        <thead>
          <tr>
            <th class="text-center">#</th>
            <th>Student</th>
            <th>Course</th>
            <th class="text-center">Enroll Date</th>
            <th class="text-center">Status</th>
            <th class="text-center">Grade</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
  <tr *ngFor="let e of rows; index as i">
    <td class="text-center text-muted">#{{ e.id || (i + 1) }}</td>

    <!-- Student name as a link + avatar -->
    <td>
      <div class="widget-content p-0">
        <div class="widget-content-wrapper">
          <div class="widget-content-left me-3">
            <div class="widget-content-left">
              <img
                width="40" height="40" class="rounded-circle"
                [src]="avatarUrl(studentFirstName(e))"
                [alt]="studentName(e)" />
            </div>
          </div>
          <div class="widget-content-left flex2">
            <a href="javascript:void(0)"
               class="fw-bold text-decoration-none"
               (click)="openStudentDetails(e, studentModal)">
              {{ studentName(e) }}
            </a>
            <div class="widget-subheading opacity-7">Student</div>
          </div>
        </div>
      </div>
    </td>

    <!-- Course name as a link -->
    <td>
      <a href="javascript:void(0)"
         (click)="openCourseDetails(e, courseModal)">
        {{ courseName(e) }}
      </a>
    </td>

    <td class="text-center">{{ e.enrollDate || '—' }}</td>
    <td class="text-center">{{ e.completionStatus || '—' }}</td>
    <td class="text-center">{{ e.grade ?? '—' }}</td>

    <td class="text-center">
      <div role="group" class="btn-group-sm btn-group">
        <button class="btn-shadow btn btn-outline-danger" (click)="remove(e.id!)">
          Delete
        </button>
      </div>
    </td>
  </tr>

  <tr *ngIf="!loading && rows.length === 0">
    <td colspan="7" class="text-center text-muted py-4">No enrollments found</td>
  </tr>
</tbody>
      </table>
    </div>
  </div>
</div>

<!-- Student Details Modal -->
<ng-template #studentModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Student Details</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body" *ngIf="selectedStudent as s">
    <div class="d-flex align-items-center gap-3 mb-3">
      <img width="60" height="60" class="rounded-circle"
           [src]="avatarUrl(s.firstName)"
           [alt]="s.firstName" />
      <div>
        <div class="fw-bold fs-5">{{ s.firstName }} {{ s.lastName }}</div>
        <div class="text-muted">{{ s.email }}</div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-md-6">
        <div class="small text-muted">Date of Birth</div>
        <div>{{ s.dateOfBirth || '—' }}</div>
      </div>
      <div class="col-md-6">
        <div class="small text-muted">Registered</div>
        <div>{{ s.registrationDate || '—' }}</div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.close()">Close</button>
  </div>
</ng-template>

<!-- Course Details Modal -->
<ng-template #courseModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Course Details</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body" *ngIf="selectedCourse as c">
    <div class="mb-1 fw-bold fs-5">{{ c.courseName }}</div>
    <div class="mb-3 text-muted">{{ c.description || '—' }}</div>

    <div class="row g-3">
      <div class="col-sm-4">
        <div class="small text-muted">Duration (h)</div>
        <div>{{ c.duration ?? '—' }}</div>
      </div>
      <div class="col-sm-4">
        <div class="small text-muted">Start Date</div>
        <div>{{ c.startDate || '—' }}</div>
      </div>
      <div class="col-sm-4">
        <div class="small text-muted">End Date</div>
        <div>{{ c.endDate || '—' }}</div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.close()">Close</button>
  </div>
</ng-template>
